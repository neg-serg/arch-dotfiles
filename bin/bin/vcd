#!/bin/dash
abspath() {
    local result=""
    if [ -x "$(which realpath 2> /dev/null)" ]; then
        result="$(realpath -s """$1""" 2> /dev/null)"
    fi
    if [ -z "$result" ] && [ -x "$(which python3 2> /dev/null)" ]; then
        result="$(python3 -c 'import sys, os;sys.stdout.write(os.path.abspath(sys.argv[1]))' """$1""")"
    fi
    if [ -z "$result" ] && [ -x "$(which realpath 2> /dev/null)" ]; then
        result="$(realpath """$1""")"
    fi
    if [ -z "$result" ]; then
        result="$1"
    fi
    if [ ! -d "$result" ]; then
        echo "$(dirname $result)"
    else
        echo "$result"
    fi
}
name="$(abspath """$1""")"
if [ -x "$(which nvr 2> /dev/null)" ]; then
    nvr --servername "$NVIM_LISTEN_ADDRESS" --remote-send ":cd $name<CR>"
else
    exit 2
fi
