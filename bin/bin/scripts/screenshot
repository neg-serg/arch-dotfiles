#!/bin/dash
select_window_=false
current_window_=false
apply_colorpace_=false
delay_min_=false
delay_=false

scr_dir=~/tmp/shots
window='root'
name="screenshot"
filename="${name}-$(date +%Y-%m-%d_%H-%M-%S).png"
colorspace_='0.96,0.5,0.09'
urgency_=normal
summary_="$scr_dir/$filename"

shot_notify() {
    ~/bin/scripts/pic_notify "$summary_"
}

make_shot() {
    arglist=" -p 0 "
    [ $select_window_ ] && arglist="$arglist -s "
    [ $current_window_ ] && arglist="$arglist -i \"$(xdotool getactivewindow)\" "
    [ $apply_colorspace_ ] && arglist="$arglist -c $colorspace_ "
    [ $delay_min_ ] && arglist="$arglist -d 0.5 "
    [ $delay_ ] && arglist="$arglist -d 5 "
    arglist="$summary_"
    maim $arglist && shot_notify
}

[ ! -d "$scr_dir" ] && mkdir "$scr_dir"

Select() {
    select_window_=true
    make_shot "$@"
}

Full() {
    make_shot "$@"
}

Current() {
    delay_min_=true;
    current_window_=true;
    make_shot "$@";
}

Delay() {
    delay_=true;
    make_shot "$@";
}

opts='"Full shot" "Rectangular selection shot" "Current window" "Delayed shot"'

Menu() {
    rofi_cmd="rofi -dmenu -theme clip"
    case $(for opt in $opts; do echo $opt; done | eval $rofi_cmd) in
        -r) Select "$@" ;;
        -f) Full "$@" ;;
        -c) Current "$@" ;;
        -d) Delay "$@" ;;
    esac
}

show_help() {
echo "Script to create screenshot and show notification.\n" \
     "\n" \
     "  -r          run selection mode\n"  \
     "  -c          screenshot current window\n"  \
     "  -d          add delay\n" \
     "  -m          show menu for options\n" \
     "  -h          display this help and exit\n"
}

case "$1" in
    -r) Select "$@" ;;
    -c) Current "$@" ;;
    -d) Delay "$@" ;;
    -m) Menu "$@" ;;
    --help) show_help ;;
    -h) show_help ;;
    *) Full "$@" ;;
esac
