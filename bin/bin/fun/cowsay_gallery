#!/bin/bash
# This script generates a gallery of cowsay/cowthink
# in reStructuredText for my blog post.
#
# Written by Yu-Jie Lin, released in Public Domain.
#
# Taken from:
# http://blog.yjl.im/2014/04/cowsaycowthink-gallery.html#80a7-dragon

declare -A styles=(
  [b]=Borg
  [d]=dead
  [g]=greedy
  [p]=paranoia
  [s]=stoned
  [t]=tired
  [w]=wired
  [y]=youthful
)

section() {
  echo "$1"
  echo "${1//?/$2}"
  echo
}

embed_cow() {
  local cmd="$1"
  shift
  echo '::'
  echo
  "$cmd" $@ | sed 's/^/  /'
  echo
}

embed_cowsay() {
  embed_cow cowsay $@
}

embed_cowthink() {
  embed_cow cowthink $@
}

echo ".. generated by $0"
echo ".. generated at $(date --utc --rfc-3339=seconds)"
echo

#######################
# cowsay and cowthink #
#######################

section '``cowsay``/``cowthink``' '='

section '``cowsay``' '-'
embed_cowsay "I'm just sayin'"

section '``cowthink``' '-'
embed_cowthink "I'm just thinkin'"

####################
# eyes and tonques #
####################

section 'Predefined eyes and tongues' '='
for s in "${!styles[@]}"; do
  section '``-'$s'``'" ${styles[$s]}" '-'
  embed_cowsay -$s "I'm ${styles[$s]}!"
done

#############
# cow files #
#############

section 'Cow files' '='
for f in $(cowsay -l | tail -n +2); do
  section '``'$f'``' '-'
  embed_cowsay -f "$f" "I'm $f!"
done

##############
# embed self #
##############

section 'Script generates this gallery' '='
echo '.. code:: sh'
echo
sed 's/^/  /' < "$0"
