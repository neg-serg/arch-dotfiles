#!/bin/bash

# Thx to _minego

SESSION="code"
cd ${HOME}/src/
mkdir -p sessions

while [ $# -gt 0 ]; do
	case "$1" in
		"-*")
			echo "Unknown argument: $1"
			exit 1
			;;

		*)
			if [ "x${NAME}x" != "xx" ]; then
				echo "Unknown argument: $1"
				exit 1
			fi

			NAME="$1"
			SESSION="${SESSION}_${NAME}"

			cd "${HOME}/src/${NAME}"

			if [ $? -ne 0 ]; then
				echo "Unknown project: ${NAME}"
				exit 1
			fi
			;;
	esac
	shift
done

if [ "x${NAME}x" == "xx" ]; then
	echo "Usage: $0 <project name>"
	exit 1
fi

NVIM_SESSION="${HOME}/src/sessions/${NAME}"

if [[ ! -f "${NVIM_SESSION}" ]]; then
	echo "Could not find vi session"
	echo ""
	echo "After setting expected options, create the session in vi by running"
	echo "   :mksession ${NVIM_SESSION}"
	echo ""
	echo "Hit enter to continue"
	read
fi

# TODO How do I define what gets loaded in this session?
dtach -A .dtach-socket -z -r winch nvim -S "${NVIM_SESSION}"
